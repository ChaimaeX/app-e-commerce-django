{% extends "index.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.7/css/all.css">
<link rel="stylesheet" href="{% static 'css/style2.css'%}">

<section id="page-header" class="contact-header">
    <h2>#Parlons</h2>
    <p>LAISSEZ UN MESSAGE, nous aimons avoir de vos nouvelles !</p>
</section>

<section id="contact-details" class="section-p1">
    <div class="details">
        <span>ENTRER EN CONTACT</span>
        <h2>Visitez l'une de nos agences ou contactez-nous dès aujourd'hui</h2>
        <h3>Siège Social</h3>
        <div>
            <li>
                <i class="fas fa-map"></i>
                <p>Lot N°109 et 110, Zone Industrielle, Sidi Slimane Moul Kifane, Sidi Slimane.</p>
            </li>
            <li>
                <i class="fas fa-envelope"></i>
                <p>contact@indokalab.com</p>
            </li>
            <li>
                <i class="fas fa-phone"></i>
                <p>+212-673327415 | +212-663381019 | +212-535300340</p>
            </li>
            <li>
                <i class="fas fa-clock"></i>
                <p>Lun - Sam : 9:00 AM à 18:00 PM</p>
            </li>
        </div>
    </div>
    <div class="map">
        <iframe
         src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3313.6984195118275!2d-5.473505124572222!3d33.84588727323532!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xda04904afc3df2d%3A0x84fb3c92fef7c668!2sLa%20Colombe!5e0!3m2!1sfr!2sma!4v1716975424779!5m2!1sfr!2sma" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
            </iframe>
    </div>
</section>

<section id="form-details">
    <form method="post">
        {% csrf_token %}
        <span>LAISSEZ UN MESSAGE</span>
        <h2>Nous aimons avoir de vos nouvelles</h2>
        <input type="text" placeholder="Votre Nom" name="name">
        <input type="email" placeholder="Votre Email" name="email">
        <input type="text" placeholder="Sujet" name="subj">
        <textarea cols="30" rows="10" placeholder="Votre Message" name="message"></textarea>
        <button type="submit" class="normal">Soumettre</button>
    </form>
    <div class="people">
        <div>
            <img src="{% static 'img/icon.webp' %}">
            <p><span>ANOUAR ABBI</span> Directeur Commerciale <br> Téléphone: +212 614-111111 / +212 661-613747 <br>Email: abbianouar2022@gmail.com / abbi.anouar@hotmail.fr</p>
        </div>
        <div>
            <img src="{% static 'img/icon.webp' %}">
            <p><span>ROCHDI ABOU EL ABBES</span> Responsable Marketing <br> Téléphone: +212 657-799578 / +212 663-207341 <br>Email: rochdiabou@gmail.com</p>
        </div>
        <div>
            <img src="{% static 'img/icon.png' %}">
            <p><span>LOUBNA EZZAHRI</span> Service Achat <br> Téléphone: +212 535-300340 <br>Email: loubanaezzahri@gmail.com</p>
        </div>
        
    </div>
</section>

  {% endblock content %}
  {% block js %}
<script src="app1.js"></script>

<script>
    
  $(document).ready(function() {
  // Function to update cart item quantity
  function changeQuantityCart(product_id, type) {
      if (cart.hasOwnProperty(product_id)) {
          switch (type) {
              case 'plus':
                  cart[product_id][0]++;
                  break;
              case 'minus':
                  if (cart[product_id][0] > 1) {
                      cart[product_id][0]--;
                  } else {
                      delete cart[product_id];
                  }
                  break;
          }
          updateCart();
          updateLocalStorage();
          
      }
  }

  // Event listener for plus and minus buttons
  $('.quantity').on('click', '.minus, .plus', function() {
      let product_id = $(this).data('product-id');
      let type = $(this).hasClass('plus') ? 'plus' : 'minus';
      changeQuantityCart(product_id, type);
  });

  // Initialize cart from localStorage
  let cart = localStorage.getItem('cart') ? JSON.parse(localStorage.getItem('cart')) : {};

  // Function to update local storage
  function updateLocalStorage() {
      localStorage.setItem('cart', JSON.stringify(cart));
  }

  // Update cart display
  function updateCart() {
      let total = 0;
      let quantityTotal = 0;

      $('#item-list').empty(); // Clear existing items

      for (let item in cart) {
          if (cart.hasOwnProperty(item)) {
              let [quantity, name, price, imageUrl] = cart[item];
              let subtotal = quantity * price;
              total += subtotal;
              quantityTotal += quantity;
              console.log(imageUrl);
              let itemString = `<tr>
                  <td>
                      <div class="item">
                          <div class="product-info">
                              <img src="${imageUrl}"/>
                              <div>
                                  <input type="hidden" name="item" value="${item}">
                                  <p>${name}</p>
                                  <small>${price} dh</small>
                              </div>
                          </div>
                      </div>
                  </td>
                  <td>
                      <div class="quantity">
                          <span class="minus" data-product-id="${item}">-</span>
                          <span>${quantity}</span>
                          <span class="plus" data-product-id="${item}">+</span>
                      </div>
                  </td>
                  <td>
                      <span class="product">${subtotal} dh</span>
                  </td>
              </tr>`;
              $('#item-list').append(itemString);
          }
      }

      $('#subtotal').text(total + ' dh');
      $('#total').val(total + 'dh');
      $('#TQTE').text(quantityTotal);
      document.getElementById("panier").innerHTML = quantityTotal;
  }

  // Event listener for 'Add to Cart' buttons
  $(document).on('click', '.ted', function() {
      console.log('Add to Cart');
      let item_id = $(this).attr('id');
      const isAuthenticated = $(this).attr('value'); 
     
      if (isAuthenticated == 'True') {
          console.log(isAuthenticated);
          document.getElementById("successMessage").style.display = "block"; // Afficher le message
           setTimeout(function(){
           document.getElementById("successMessage").style.display = "none"; // Masquer le message après 2 secondes
           }, 2000);
          if (cart[item_id] != undefined) {
              cart[item_id][0]++;
          } else {
              console.log($('#img' + item_id).attr('src'));
              cart[item_id] = [1, $('#aa' + item_id).text(), parseFloat($('#price' + item_id).text()), $('#img' + item_id).attr('src')];
          }
          updateCart();
          updateLocalStorage();
      } else {
          alert("Veuillez vous connecter pour acheter ce produit.");
      }
  });

  // Update cart display on page load
  updateCart();
 
});
function affichageErreur() {
    
    const targetNotification = document.querySelector('.notification');
      
            //  targetNotification.style.display = "block"; // Afficher le message
            //  setTimeout(function(){
            //  targetNotification.style.display = "none"; // Masquer le message après 2 secondes
            //  }, 5000);
        

        targetNotification.classList.toggle('showed');
        // Set auto close for 5 seconds
        setTimeout(function() {
            targetNotification.classList.remove('showed');
        }, 5000);
        const closes = document.querySelectorAll('.close');
 
        closes.forEach(function(el) {
        el.addEventListener('click', function() {
        const parentNotification = el.parentNode;
        if (parentNotification.classList.contains('showed')) {
            parentNotification.classList.remove('showed');
        }
    });
});

}

</script>
{% endblock %}